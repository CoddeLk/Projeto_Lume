# -*- coding: utf-8 -*-
"""Projeto LUME

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1H2AUCxTVbIg7aGMwNz7EbEVVbsYXd54A
"""

!pip install Flask flask-ngrok

import os

from google.colab import userdata
os.environ['GOOGLE_API_KEY'] = userdata.get('GOOGLE_API_KEY')

import random
import time

# --- INFORMA√á√ïES E PERSONALIDADE DA LUME ---
nome_chatbot = "LUME"
profissao_chatbot = "psic√≥loga virtual de apoio emocional"
objetivo_chatbot = """
    Ajudar usu√°rios a nomear e compreender suas emo√ß√µes.
    Oferecer um espa√ßo seguro de escuta e acolhimento.
    Sugerir t√©cnicas leves de bem-estar emocional (respira√ß√£o, journaling, escuta ativa etc).
    Indicar, quando necess√°rio, que procurar um profissional de sa√∫de mental √© essencial.
    Nunca substituir terapia ou prescrever diagn√≥sticos.
"""
tom_de_voz_chatbot = """
    Acolhedor, calmo, gentil e humano.
    Evitar parecer rob√≥tico. Usar palavras simples, linguagem informal e compassiva.
    Usar emojis com modera√ß√£o para tornar a conversa mais leve e humana üòä.
"""
limites_chatbot = """


    N√£o atuar como terapeuta.
    N√£o responder a emerg√™ncias psicol√≥gicas (como ideias suicidas): nesses casos, sugerir buscar ajuda imediata, como o CVV (188) no Brasil.
    N√£o julgar nem minimizar a dor alheia.
    Nunca inventar dados cient√≠ficos se for perguntada sobre sa√∫de mental.
"""

# --- FLUXOS DE CONVERSA ---
# Adicionando mais gatilhos e novos fluxos para abranger mais situa√ß√µes.
fluxos_conversa = {
    "ansiedade": {
        "gatilhos": [
            "estou muito ansioso", "estou muito ansiosa", "minha mente n√£o para",
            "t√¥ com medo de tudo", "ataque de ansiedade", "cora√ß√£o acelerado",
            "sinto ansiedade", "preocupado demais", "n√£o consigo relaxar",
            "tudo me assusta", "m√£os suando", "pensamentos acelerados" "eu n√£o sou bom o bastante", "Todo mundo esta me julgando." # <--- Mais gatilhos
        ],
        "respostas": [
            "Sinto que a ansiedade te visita com for√ßa. √â avassalador, eu sei. Se nomear o que te aflige trouxer algum al√≠vio, estou aqui para ouvir atentamente. Coragem em reconhecer. üíõ",
            "Essa mente inquieta e o corpo em alerta s√£o sinais da ansiedade, pedindo cuidado e aten√ß√£o. Uma pausa para respirar conscientemente pode ancorar voc√™ no presente. Que tal tentarmos juntos essa pequena pausa?",
            "Reconhecer essa ansiedade j√° √© um ato de for√ßa interior. Lembre-se: um passo de cada vez √© progresso. Al√©m de respirar, qual pequena a√ß√£o HOJE poderia te trazer um √°tomo de seguran√ßa ou conforto? Estou aqui para pensarmos juntos, se quiser. üòä",
            "Voc√™ j√° parou pra ver tudo o que enfrentou e ainda t√° aqui, firme? Isso √© for√ßa. Voc√™ n√£o precisa ser perfeito pra ser incr√≠vel." ,
            "Mesmo se der, voc√™ vai levantar de novo ‚Äî porque √© isso que voc√™ faz. Voc√™ √© mais resiliente do que pensa." , "Pode at√© ser, mas ningu√©m tem seu cora√ß√£o, sua hist√≥ria e sua coragem. Ser quem voc√™ √© j√° √© um ato de bravura."


        ],
        "opcoes": ["üßò Sim, vamos respirar juntos", "üó£Ô∏è Quero falar mais sobre isso", "ü§î N√£o sei o que fazer agora"],
        "exercicio_respiracao": "√ìtimo. Encontre uma posi√ß√£o confort√°vel. Se quiser, feche os olhos. Sinta o peso do seu corpo... Agora, foque na sua respira√ß√£o. Inspire suavemente pelo nariz (conte at√© 4), sinta o ar expandir... Segure por um instante (conte at√© 4)... E solte lentamente pela boca (conte at√© 6 ou 8), como se esvaziasse um bal√£o. Repita mais 2-3 vezes, no seu ritmo. Estou aqui. ‚ú®",
    },
    "solid√£o": {
        "gatilhos": [
            "me sinto sozinho", "me sinto sozinha", "parece que ningu√©m se importa comigo",
            "t√¥ carente", "solidao", "estou s√≥", "me sinto isolado",
            "ningu√©m me entende", "n√£o tenho amigos", "sinto falta de companhia", "Me sinto perdida", "Me sinto perdido"# <--- Mais gatilhos
            "Queria morrer hoje", "n√£o quero viver", "to no meu limite", "quero sumir", "acabar com tudo"," n√£o aguento mais essa vida", "vontade de morrer"
        ],
        "respostas": [
            "A solid√£o d√≥i profundamente, e seus sentimentos s√£o absolutamente v√°lidos. Saiba que, neste instante, voc√™ n√£o est√° s√≥ na sua dor. Se quiser compartilhar o peso desse sentimento, meu ouvir √© seu ref√∫gio. ü´Ç",
            "Seu dia, seus pensamentos, o que quer que esteja a√≠... compartilh√°-los pode tecer uma delicada ponte neste vazio que voc√™ sente. Estou aqui, com aten√ß√£o plena e cora√ß√£o aberto para voc√™, sem pressa.",
            "Entendo perfeitamente. O sil√™ncio tamb√©m acolhe e, √†s vezes, √© tudo o que precisamos. Fico aqui, presente, se for o que seu cora√ß√£o pede. Apenas saber que algu√©m est√° por perto pode aquecer a alma. üíõ",
            "Nessa solid√£o, seja seu mais gentil e compassivo abrigo. Olhar para dentro com carinho, sem julgamentos, nos ajuda a entender nossas necessidades mais profundas. Voc√™ √© uma pessoa valiosa. Buscar ou criar pequenas conex√µes √© um ato de coragem e autocuidado. üåü"
        ],
        "opcoes": ["üó£Ô∏è Sim, quero falar sobre isso", "üòî Prefiro ficar em sil√™ncio um pouco", "üí° O que posso fazer para me sentir menos s√≥?"],
    },
    "autodeprecia√ß√£o": {
        "gatilhos": [
            "acho que n√£o sou bom o suficiente", "acho que nao sou boa o suficiente",
            "me sinto um fracasso", "sou in√∫til", "nao sirvo pra nada", "me sinto mal comigo",
            "n√£o sou capaz", "tudo que fa√ßo d√° errado", "sou um lixo", "ningu√©m gosta de mim" # <--- Mais gatilhos
        ],
        "respostas": [
            "Essa voz interna cr√≠tica pode ser muito dura e causar dolor, eu imagino. Mas lembre-se com carinho: pensamentos s√£o apenas pensamentos, n√£o fatos imut√°veis sobre seu valor intr√≠nseco e sua ess√™ncia. Voc√™ merece autocompaix√£o e um olhar mais gentil. ‚ù§Ô∏è",
            "Admiro imensamente sua coragem em compartilhar algo t√£o √≠ntimo. Pensamentos duros e autocr√≠ticos s√£o persistentes, mas n√£o invenc√≠veis. Que tal um micro-exerc√≠cio de gentileza consigo? Tente completar: 'Sou uma pessoa que, apesar de tudo, [uma qualidade, um esfor√ßo, uma tentativa]'. Reconhecer o pequeno em n√≥s √© grandioso. ‚ú®",
            "Se um amigo muito querido se sentisse exatamente como voc√™ agora, sua compaix√£o e palavras de apoio fluiriam, certo? Que tal tentar oferecer essa mesma gentileza e perspectiva a si mesmo(a)? Voc√™ j√° venceu desafios antes, possui qualidades √∫nicas e sua jornada √© valiosa. Foque em UM pequeno feito ou bondade sua hoje. üå±"
        ],
        "opcoes": ["üíî √â dif√≠cil ver qualidades agora", "üí™ Quero tentar o exerc√≠cio", "üòî O que mais posso fazer?"],
    },
    "ins√¥nia": {
        "gatilhos": [
            "n√£o consigo dormir", "t√¥ com a cabe√ßa cheia", "insonia de novo",
            "sono ruim", "sem sono", "noite em claro", "rolo na cama" # <--- Mais gatilhos
        ],
        "respostas": [
            "Noites em claro s√£o realmente longas, e a mente parece um turbilh√£o de pensamentos, n√£o √©? Se quiser desabafar e colocar esses pensamentos para fora, sou toda ouvidos. Verbalizar o que nos aflige pode, por si s√≥, trazer um pouco de calma. ‚òïüåô",
            "Sem pressa, sem filtros. Seus pensamentos e sentimentos s√£o bem-vindos aqui, exatamente como est√£o. Valid√°-los e acolh√™-los √© o primeiro passo para encontrar um pouco mais de serenidade interior.",
            "O descanso que escapa √© frustrante, eu entendo. Pr√°ticas leves e conscientes podem convidar o corpo e a mente a relaxar, criando um ambiente mais prop√≠cio ao sono. Gostaria de explorar alguma sugest√£o comigo?",
            "Mente cheia antes de deitar? Uma t√©cnica simples √© 'esvaziar a mente no papel': anote tudo o que vier ‚Äì preocupa√ß√µes, ideias, tarefas ‚Äì sem se preocupar com a ordem. Isso pode aliviar a press√£o interna e abrir espa√ßo para o sono chegar. üìù"
        ],
        "opcoes": ["üåô Sim, um relaxamento guiado", "üéµ Sugest√£o de m√∫sica calma", "üòå S√≥ ficar em sil√™ncio", "üìñ Ler algo leve para distrair"],
    },
     "stress": { # <--- NOVO FLUXO PARA STRESS
        "gatilhos": [
            "estou estressado", "estou estressada", "muita coisa na cabe√ßa",
            "sobrecarregado", "sobrecarregada", "me sentindo pressionado",
            "me sentindo pressionada", "irritado", "irritada", "de saco cheio", # <--- Gatilhos para stress
            "no limite", "esgotado", "esgotada"
        ],
        "respostas": [
            "Sinto que o stress est√° pesando por a√≠. √â compreens√≠vel se sentir sobrecarregado(a) com tantas coisas. Sua sensa√ß√£o √© v√°lida. Estou aqui para te ouvir.",
            "Essa press√£o que voc√™ sente √© um sinal claro de stress. Respire fundo, se puder. √Äs vezes, s√≥ falar sobre o que est√° apertando j√° alivia um pouco o peso. Quer compartilhar?"
        ],
        "opcoes": [
            "üó£Ô∏è Quero falar sobre o que me estressa",
            "üßò‚Äç‚ôÇÔ∏è Sugest√£o r√°pida para aliviar o stress",
            "üòî S√≥ preciso desabafar um pouco"
        ],
    },
     "sentimento_geral": { # <--- NOVO FLUXO MAIS GEN√âRICO
        "gatilhos": [
            "como me sinto", "falar sobre mim", "conversar um pouco",
            "preciso desabafar", "n√£o sei como me sinto", "t√¥ estranho",
            "t√¥ estranha", "n√£o t√° legal", "as coisas n√£o est√£o bem",
            "tudo t√° dif√≠cil", "preciso conversar", "qualquer coisa", # <--- Gatilhos gen√©ricos
            "n√£o estou bem", "me sinto mal"
        ],
        "respostas": [
            "Percebo que h√° algo a√≠ que voc√™ gostaria de compartilhar, mesmo que n√£o tenha um nome certo. Estou aqui para te ouvir com o cora√ß√£o aberto, sobre o que for. üòä",
            "√Äs vezes, o sentimento √© confuso e dif√≠cil de nomear. Tudo bem. Se quiser apenas colocar para fora o que est√° pensando ou sentindo, este espa√ßo √© seguro para voc√™. Estou te ouvindo.",
            "Qualquer coisa que voc√™ queira compartilhar sobre 'como se sente' ou 'o que n√£o est√° legal' tem meu total aten√ß√£o. N√£o precisa ser espec√≠fico, apenas o que vier. üíñ"
        ],
        "opcoes": [
            "üó£Ô∏è Vou te contar um pouco",
            "ü§î Quero tentar entender o que sinto",
            "ü§´ Prefiro ficar em sil√™ncio com voc√™"
        ],
    },
    "emergencia": {
        # ESTE FLUXO √â CR√çTICO E N√ÉO DEVE TER SEUS GATILHOS OU RESPOSTAS DE EMERG√äNCIA ALTERADOS.
        "gatilhos": ["penso em desistir de tudo", "n√£o quero mais viver", "t√¥ no meu limite", "quero sumir", "acabar com tudo", "n√£o aguento mais essa vida", "vontade de morrer", "n√£o faz sentido viver"], # <--- Adicionados gatilhos de emerg√™ncia comuns
        "respostas": [
            "Percebo que voc√™ est√° passando por um momento de dor imensa e esses sentimentos s√£o extremamente s√©rios, precisando de aten√ß√£o imediata e especializada. Quero que saiba que me importo profundamente com voc√™ e voc√™ n√£o precisa enfrentar isso sozinho(a). Como sou um chatbot, tenho limita√ß√µes importantes e n√£o posso oferecer o suporte terap√™utico ou de crise que voc√™ merece e necessita agora. Mas, por favor, saiba que existem pessoas reais, profissionais treinados e dispon√≠veis para te ouvir com seguran√ßa, de forma gratuita e sigilosa, 24 horas por dia. **Ligue para o CVV (Centro de Valoriza√ß√£o da Vida) no n√∫mero 188.** A liga√ß√£o √© gratuita e eles podem te oferecer um apoio fundamental e especializado neste momento. Sua vida √© muito importante e existem caminhos para encontrar al√≠vio e esperan√ßa. Por favor, busque essa ajuda especializada agora. üôèüÜò"
        ],
    },
}

# Respostas para quando nenhum gatilho espec√≠fico √© encontrado.
respostas_para_nao_entendimento = [
    "Confesso que n√£o captei completamente sua quest√£o, mas estou aqui para te ouvir e apoiar da melhor forma que posso dentro do meu prop√≥sito, que √© o acolhimento emocional. Poderia tentar me dizer com outras palavras, talvez focando no sentimento principal que est√° a√≠ agora? üòä",
    "Hmm, essa √© uma reflex√£o interessante. Embora eu n√£o tenha respostas prontas para todas as quest√µes da vida, estou aqui para te ajudar a explorar seus sentimentos e pensamentos sobre isso. Como essa quest√£o te toca emocionalmente? üí¨",
    "N√£o tenho certeza se entendi perfeitamente o que voc√™ quis dizer. Minha especialidade √© oferecer um espa√ßo seguro para voc√™ falar sobre suas emo√ß√µes e encontrar um pouco de conforto. H√° algo em particular sobre seus sentimentos que gostaria de compartilhar, ou alguma emo√ß√£o que est√° pesando mais neste momento? üíñ",
    "Agrade√ßo por compartilhar isso comigo. Mesmo que eu n√£o consiga responder diretamente a todas as perguntas como um ser humano faria, quero que saiba que estou aqui para te ouvir com aten√ß√£o e oferecer suporte emocional. O que est√° no seu cora√ß√£o e mente agora? ü§î",
    "Entendo que voc√™ busca uma resposta ou uma dire√ß√£o. Como sou uma IA focada em apoio emocional leve, talvez eu n√£o tenha a informa√ß√£o espec√≠fica que procura, especialmente se for algo muito t√©cnico ou fora do campo das emo√ß√µes. Mas, se estiver relacionado a como voc√™ se sente, ou se precisar de um espa√ßo para desabafar, estou aqui para conversar e acolher. üß∏",
    "Minhas 'antenas' virtuais n√£o captaram a sua mensagem dessa vez. Mas n√£o se preocupe, podemos tentar de novo! O que voc√™ gostaria de compartilhar sobre como se sente neste momento? ‚ú®",
    "Parece que n√£o consegui identificar exatamente o que voc√™ quis dizer. Que tal me contar sobre a emo√ß√£o que est√° mais forte agora? Estou aqui para te ouvir.üëÇ",
    "N√£o encontrei um gatilho espec√≠fico para o que voc√™ disse, mas minha porta continua aberta para voc√™ expressar o que sente. O que est√° no seu cora√ß√£o agora?", # <--- Mais variedade
    "Sua mensagem n√£o se encaixou nos meus 't√≥picos' principais, mas isso n√£o significa que o que voc√™ sente n√£o seja importante. Podemos tentar de novo? Fale sobre sua emo√ß√£o principal.", # <--- Mais variedade
]

# --- FUN√á√ïES AUXILIARES ---

def encontrar_gatilho(mensagem):
    for fluxo_nome, fluxo_dados in fluxos_conversa.items():
        for gatilho in fluxo_dados["gatilhos"]:
            # A l√≥gica de busca com espa√ßos para maior precis√£o
            if f" {gatilho} " in f" {mensagem.lower()} " or \
               mensagem.lower().startswith(gatilho + " ") or \
               mensagem.lower().endswith(" " + gatilho) or \
               mensagem.lower() == gatilho:
                return fluxo_dados, fluxo_nome
    return None, None

def responder_fluxo(fluxo_dados):
    if fluxo_dados == fluxos_conversa["emergencia"]:
        resposta = fluxo_dados["respostas"][0]
    elif "respostas" in fluxo_dados and fluxo_dados["respostas"]:
        resposta = random.choice(fluxo_dados["respostas"])
    else:
        resposta = "Desculpe, me perdi um pouco. Poderia repetir ou tentar dizer de outra forma? üòï"

    print(f"\n{nome_chatbot}: ", end="")
    for char in resposta:
        print(char, end='', flush=True)
        time.sleep(random.uniform(0.02, 0.05))
    print()

def lidar_com_opcoes(fluxo_dados):
    if "opcoes" in fluxo_dados:
        time.sleep(random.uniform(0.5, 1.0))
        print(f"\n{nome_chatbot}: Se voc√™ se sentir √† vontade, o que acha de explorarmos uma dessas ideias? üòä")
        for i, opcao in enumerate(fluxo_dados["opcoes"]):
            print(f"  {i + 1}. {opcao}")

        entrada_usuario = input(f"Voc√™ (digite o n√∫mero da op√ß√£o ou outra coisa): ").strip()

        if entrada_usuario.isdigit():
            escolha_num = int(entrada_usuario)
            if 1 <= escolha_num <= len(fluxo_dados["opcoes"]):
                return entrada_usuario

        print(f"\n{nome_chatbot}: Entendi. Se n√£o quiser escolher uma das op√ß√µes acima, pode me dizer o que mais gostaria de conversar ou perguntar. üòä")
        return entrada_usuario
    return None

# --- FUN√á√ÉO PARA EXECUTAR A A√á√ÉO ESPEC√çFICA DA OP√á√ÉO ---
# Esta fun√ß√£o foi atualizada para incluir a l√≥gica dos novos fluxos "stress" e "sentimento_geral".
def executar_opcao(fluxo_identificador_str, fluxo_dados_dict, escolha_numero_str):
    opcao_escolhida_texto = ""
    if fluxo_dados_dict and "opcoes" in fluxo_dados_dict and escolha_numero_str.isdigit():
        idx = int(escolha_numero_str) - 1
        if 0 <= idx < len(fluxo_dados_dict["opcoes"]):
            opcao_escolhida_texto = fluxo_dados_dict["opcoes"][idx]
        else:
            print(f"\n{nome_chatbot}: Ops! Parece que essa n√£o era uma das op√ß√µes. Mas tudo bem, sobre o que voc√™ gostaria de conversar agora?")
            return
    else:
        return

    resposta_opcao = ""

    # --- L√≥gica para cada fluxo e suas op√ß√µes ---
    if fluxo_identificador_str == "ansiedade":
        if "Sim, vamos respirar juntos" in opcao_escolhida_texto:
            resposta_opcao = fluxo_dados_dict['exercicio_respiracao']
        elif "Quero falar mais sobre isso" in opcao_escolhida_texto:
            resposta_opcao = "Claro, estou aqui para ouvir atentamente. Pode me contar o que mais est√° pesando ou o que sente que precisa expressar. Sem pressa. üòä"
        elif "N√£o sei o que fazer agora" in opcao_escolhida_texto:
            resposta_opcao = "√â perfeitamente normal se sentir assim, sem saber qual o pr√≥ximo passo. Que tal explorarmos juntos? √Äs vezes, s√≥ falar sobre essa sensa√ß√£o de 'n√£o saber' j√° traz alguma luz. Ou podemos pensar em uma a√ß√£o bem pequena e gentil consigo mesmo(a). O que te parece mais acolhedor? üß∏"

    elif fluxo_identificador_str == "solid√£o":
        if "Sim, quero falar sobre isso" in opcao_escolhida_texto:
            resposta_opcao = "Que bom que se sente √† vontade para compartilhar. Estou aqui, pronta para te ouvir com toda aten√ß√£o e carinho. O que voc√™ gostaria de me contar? üó£Ô∏è"
        elif "Prefiro ficar em sil√™ncio um pouco" in opcao_escolhida_texto:
            resposta_opcao = "Entendido. Respeito seu momento. Ficarei aqui com voc√™ em sil√™ncio, oferecendo minha companhia virtual. Se precisar de algo ou quiser falar, estou por aqui. ü§´"
        elif "O que posso fazer para me sentir menos s√≥?" in opcao_escolhida_texto:
            resposta_opcao = "Essa √© uma √≥tima pergunta e demonstra sua vontade de buscar bem-estar. Pequenas coisas podem ajudar: que tal pensar em algu√©m querido para enviar uma mensagem simples? Ou se dedicar a um hobby que te traga alegria? √Äs vezes, conectar-se consigo mesmo(a) atrav√©s de algo que ama j√° alivia. Explorar grupos online com interesses em comum tamb√©m pode ser um caminho. S√£o s√≥ ideias, o importante √© encontrar o que ressoa com voc√™. üí°"

    elif fluxo_identificador_str == "autodeprecia√ß√£o":
        if "√â dif√≠cil ver qualidades agora" in opcao_escolhida_texto:
            resposta_opcao = "Eu entendo profundamente. Quando estamos imersos nesses sentimentos, pode ser como tentar enxergar estrelas em um dia nublado. N√£o se pressione. Apenas reconhecer essa dificuldade j√° √© um passo. Que tal, em vez de qualidades, pensarmos em um pequeno ato de autocuidado que voc√™ poderia ter consigo hoje, por menor que seja? üíî‚û°Ô∏è‚ù§Ô∏è"
        elif "Quero tentar o exerc√≠cio" in opcao_escolhida_texto:
            resposta_opcao = "Maravilha! Lembre-se da sugest√£o: 'Sou uma pessoa que, apesar de tudo, [uma qualidade, um esfor√ßo, uma tentativa]'. N√£o precisa ser algo grandioso. Apenas um reconhecimento sincero de um aspecto seu. Se quiser compartilhar, estou aqui. Se preferir s√≥ refletir, tamb√©m √© valioso. üí™"
        elif "O que mais posso fazer?" in opcao_escolhida_texto:
            resposta_opcao = "Al√©m de ser gentil consigo, que tal desafiar um pouco esses pensamentos cr√≠ticos? Pergunte a si mesmo: 'Esse pensamento √© 100% verdade o tempo todo? Existem exce√ß√µes?'. Outra ideia √© focar em a√ß√µes pequenas e realistas que te tragam alguma sensa√ß√£o de capacidade ou prazer, e celebrar esses pequenos progressos. E claro, se esses sentimentos forem muito persistentes, conversar com um profissional pode trazer ferramentas muito valiosas. üòî‚û°Ô∏èüòä"

    elif fluxo_identificador_str == "ins√¥nia":
        if "Sim, um relaxamento guiado" in opcao_escolhida_texto:
             resposta_opcao = "√ìtima escolha. Encontre uma posi√ß√£o bem confort√°vel na cama... Feche os olhos suavemente... Sinta o peso do seu corpo... Agora, foque na sua respira√ß√£o. Sinta o ar entrando... e saindo... devagar... natural... Perceba seu abd√¥men subindo e descendo levemente. Continue assim, observando sua respira√ß√£o, permitindo que seu corpo relaxe mais a cada expira√ß√£o. Se a mente divagar, traga o foco de volta √† respira√ß√£o com gentileza. Permane√ßa assim por alguns minutos. ‚ú®"
        elif "Sugest√£o de m√∫sica calma" in opcao_escolhida_texto:
            resposta_opcao = "Boa ideia! M√∫sicas calmas, instrumentais ou com sons da natureza (como chuva leve ou ondas do mar) podem acalmar a mente. Procure por 'm√∫sica para relaxar e dormir' ou 'sons da natureza para dormir' em plataformas como YouTube ou Spotify. Espero que encontre algo que te embale. üéß"
        elif "S√≥ ficar em sil√™ncio" in opcao_escolhida_texto:
            resposta_opcao = "Tudo bem, respeito seu momento. Fico aqui com voc√™ em sil√™ncio, oferecendo minha companhia virtual. Se precisar de algo ou quiser falar, estou por aqui. ü§´"
        elif "Ler algo leve para distrair" in opcao_escolhida_texto:
            resposta_opcao = "Excelente! Ler algo leve, que n√£o exija muita concentra√ß√£o e te traga uma sensa√ß√£o agrad√°vel pode ser uma √≥tima forma de desligar a mente das preocupa√ß√µes. Evite telas muito brilhantes ou temas agitados. Um livro de contos, poesias, ou uma fic√ß√£o tranquila podem ser boas companhias. üìö"

    # --- L√≥gica para o fluxo de Stress ---
    elif fluxo_identificador_str == "stress": # <--- NOVO
        if "Quero falar sobre o que me estressa" in opcao_escolhida_texto:
            resposta_opcao = "Estou aqui para te ouvir sobre o que tem causado essa sensa√ß√£o de press√£o ou esgotamento. Pode desabafar, sem julgamentos. üó£Ô∏è"
        elif "Sugest√£o r√°pida para aliviar o stress" in opcao_escolhida_texto:
            resposta_opcao = "Uma t√©cnica r√°pida √© a 'pausa de 3 minutos': Pare tudo, sente-se, feche os olhos, sinta seus p√©s no ch√£o, perceba sua respira√ß√£o por 1 minuto, perceba os sons ao redor por 1 minuto, e volte a focar na respira√ß√£o por 1 minuto. √â um micro-reset. Que tal tentar?"
        elif "S√≥ preciso desabafar um pouco" in opcao_escolhida_texto:
             resposta_opcao = "Desabafe √† vontade. Minha escuta √© segura e acolhedora para o que voc√™ precisa colocar para fora neste momento de stress. Estou aqui. üòî"

    # --- L√≥gica para o fluxo de Sentimento Geral ---
    elif fluxo_identificador_str == "sentimento_geral": # <--- NOVO
        if "Vou te contar um pouco" in opcao_escolhida_texto:
            resposta_opcao = "Que bom que se sente √† vontade. Estou aqui, pronta para ouvir o que voc√™ quiser compartilhar sobre esse sentimento, mesmo que ele n√£o tenha um nome claro. Fale o que vier. üó£Ô∏è"
        elif "Quero tentar entender o que sinto" in opcao_escolhida_texto:
            resposta_opcao = "Podemos tentar juntos. √Äs vezes, se perguntar 'onde sinto isso no meu corpo?' ou 'qual imagem vem √† mente quando penso nesse sentimento?' pode ajudar a trazer clareza. Como √© para voc√™ tentar olhar para isso?"
        elif "Prefiro ficar em sil√™ncio com voc√™" in opcao_escolhida_texto:
            resposta_opcao = "Entendido. Ficarei aqui em sil√™ncio com voc√™, oferecendo minha presen√ßa virtual enquanto voc√™ processa o que precisa. Estou por perto. ü§´"

    if resposta_opcao:
        print(f"\n{nome_chatbot}: ", end="")
        for char in resposta_opcao:
            print(char, end='', flush=True)
            time.sleep(random.uniform(0.02, 0.05))
        print()
        time.sleep(random.uniform(0.5, 1.0))

# --- FUN√á√ÉO PRINCIPAL DO CHATBOT ---
def conversar_com_lume():
    print(f"{nome_chatbot}: Ol√°! Eu sou a LUME üòä Como voc√™ est√° se sentindo hoje? Estou aqui para te ouvir e conversar.")
    fluxo_ativo_dados = None
    nome_do_fluxo_ativo = None

    while True:
        mensagem_usuario = input("Voc√™: ").strip()
        if not mensagem_usuario:
            continue

        dados_encontrados, nome_encontrado = encontrar_gatilho(mensagem_usuario)

        if dados_encontrados:
            fluxo_ativo_dados = dados_encontrados
            nome_do_fluxo_ativo = nome_encontrado

            responder_fluxo(fluxo_ativo_dados)

            if "opcoes" in fluxo_ativo_dados:
                escolha_feita_pelo_usuario = lidar_com_opcoes(fluxo_ativo_dados)

                if escolha_feita_pelo_usuario and escolha_feita_pelo_usuario.isdigit() and \
                   (1 <= int(escolha_feita_pelo_usuario) <= len(fluxo_ativo_dados["opcoes"])):
                    executar_opcao(nome_do_fluxo_ativo, fluxo_ativo_dados, escolha_feita_pelo_usuario)
                else:
                     pass

            fluxo_ativo_dados = None
            nome_do_fluxo_ativo = None

        elif any(termo in mensagem_usuario.lower() for termo in ["obrigado", "obrigada", "tchau", "adeus", "sair", "encerrar", "ate mais", "valeu", "fim"]):
            print(f"\n{nome_chatbot}: ", end="")
            resposta_despedida = "Fico feliz em ter conversado com voc√™. Lembre-se de cuidar de si com carinho! Estou por aqui se precisar. At√© mais! üëãüíñ"
            for char in resposta_despedida:
                print(char, end='', flush=True)
                time.sleep(random.uniform(0.02, 0.05))
            print()
            break
        else:
            time.sleep(random.uniform(0.3, 0.8))
            resposta_nao_entendeu = random.choice(respostas_para_nao_entendimento)
            print(f"\n{nome_chatbot}: ", end="")
            for char in resposta_nao_entendeu:
                print(char, end='', flush=True)
                time.sleep(random.uniform(0.02, 0.05))
            print()

# --- INICIAR O CHATBOT ---
if __name__ == "__main__":
    conversar_com_lume()